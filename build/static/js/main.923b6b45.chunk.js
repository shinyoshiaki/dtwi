(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{5690:function(e,t,n){e.exports=n(6261)},5917:function(e,t){},5919:function(e,t){},5951:function(e,t){},5952:function(e,t){},6166:function(e,t){},6261:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(41),i=n(44),c=n(112),l=n(409),s=n.n(l),u=n(410),d=n(411),p=n.n(d),f=n(260),h=n(60),m=n(50),v={targetUrl:void 0,node:void 0,kad:void 0},b={targetUrl:"targetUrl",node:"node",kad:"kad"},g={SET_VALUE:"SET_VALUE"};function y(e,t,n){n({type:g.SET_VALUE,data:{key:e,value:t}})}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g.SET_VALUE:return Object(m.a)({},e,Object(h.a)({},t.data.key,t.data.value));default:return e}}var k=n(15),w=n.n(k),O=n(31),j=n(39),C=n.n(j),x=n(110),I=n.n(x);function U(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{pic:void 0},o={type:"tweet",id:e,nickname:t,time:n,msg:a,hash:void 0,pic:void 0};return o.hash=I()(JSON.stringify(o)).toString(),o.pic=r.pic,o}var A={myTweets:[],lastTweet:void 0,timeline:[],userTweets:{},followIds:[],nickname:"null"},T={myTweets:"myTweets",timeline:"timeline",lastTweet:"lastTweet",followIds:"followIds",nickname:"nickname"},D={SET_VALUE:"TWITTER_SET_VALUE",PUSH_ARR:"TWITTER_PUSH_ARR",RESET_USER_TWEET:"TWITTER_RESET_USER_TWEET",ADD_USER_TWEET:"TWITTER_ADD_USER_TWEET",FOLLOW:"TWITTER_FOLLOW"};function M(e){return S.apply(this,arguments)}function S(){return(S=Object(O.a)(w.a.mark(function e(t){var n,a,r,o=arguments;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:new C.a,(a=o.length>2?o[2]:void 0)({type:D.RESET_USER_TWEET,data:t});case 3:return e.next=5,n.findValue(t).catch(console.log);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("break",17);case 8:if("tweet"!==r.type){e.next=14;break}console.log("find tweet"),R(n,a),t=r.hash,e.next=15;break;case 14:return e.abrupt("break",17);case 15:e.next=3;break;case 17:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new C.a,t=arguments.length>1?arguments[1]:void 0,n=e.keyValueList,a=[];Object.keys(n).forEach(function(e){var t=n[e];"tweet"===t.type&&a.push(t)});var r=a.sort(function(e,t){return e.time-t.time}).reverse();L(T.timeline,r,t)}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.a,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{picture:void 0};console.log("tweet module",{opt:r});var o=I()(Math.random().toString()).toString(),i=r.picture?U(t.nodeId,a.nickname,Date.now(),e,{pic:o}):U(t.nodeId,a.nickname,Date.now(),e);a.lastTweet?t.store(t.nodeId,a.lastTweet.hash,i):t.store(t.nodeId,t.nodeId,i),r.picture&&t.storeChunks(t.nodeId,o,r.picture),L(T.lastTweet,i,n),function(e,t,n){n({type:D.PUSH_ARR,data:{key:e,value:t}})}(T.myTweets,i,n),R(t,n)}function L(e,t,n){n({type:D.SET_VALUE,data:{key:e,value:t}})}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D.SET_VALUE:return Object(m.a)({},e,Object(h.a)({},t.data.key,t.data.value));case D.PUSH_ARR:return Object(m.a)({},e,Object(h.a)({},t.data.key,e[t.data.key].concat(t.data.value)));case D.RESET_USER_TWEET:return e.userTweets[t.data]=[],Object(m.a)({},e,{userTweets:e.userTweets});case D.ADD_USER_TWEET:return console.log("twitterjs reducer",{state:e}),e.userTweets[t.data.id].push(t.data),Object(m.a)({},e,{userTweets:e.userTweets});case D.FOLLOW:return e.followIds.includes(t.data)||e.followIds.push(t.data),Object(m.a)({},e,{followIds:e.followIds});default:return e}}var W={findUser:void 0,selectFile:void 0,dmUserId:void 0,loading:!1,nofiticationOpen:!1,nofiticationMessage:""},V={findUser:"findUser",selectFile:"selectFile",dmUserId:"dmUserId",loading:"loading",nofiticationOpen:"nofiticationOpen",nofiticationMessage:"nofiticationMessage"},B={SET_VALUE:"CONDITION_SET_VALUE"};function F(e,t,n){n({type:B.SET_VALUE,data:{key:e,value:t}})}function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B.SET_VALUE:return Object(m.a)({},e,Object(h.a)({},t.data.key,t.data.value));default:return e}}var N={messages:{}},Y={SEND_DM:"SEND_DM",RECEIVE_DM:"RECEIVE_DM"};function X(){return(X=Object(O.a)(w.a.mark(function e(t,n){var a,r,o,i=arguments;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:new C.a,r=i.length>3?i[3]:void 0,o=i.length>4&&void 0!==i[4]?i[4]:{file:void 0,filename:void 0},e.next=5,a.send(t,{text:n}).catch(console.log);case 5:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:if(r({type:Y.SEND_DM,data:{nodeId:t,text:n}}),!o.file){e.next=16;break}return e.next=12,a.send(t,{file:{name:o.filename,value:o.file}}).catch(console.log);case 12:if(e.sent){e.next=15;break}return e.abrupt("return");case 15:r({type:Y.SEND_DM,data:{nodeId:t,file:o.file,filename:o.filename}});case 16:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y.SEND_DM:var n=t.data;e.messages[n.nodeId]||(e.messages[n.nodeId]=[]);var a=e.messages[n.nodeId];return n.text?a.push({type:"me",text:n.text}):n.file&&a.push({type:"me",file:n.file,filename:n.filename}),Object(m.a)({},e,{messages:e.messages});case Y.RECEIVE_DM:var r=t.data;e.messages[r.nodeId]||(e.messages[r.nodeId]=[]);var o=e.messages[r.nodeId];return r.text?o.push({type:"you",text:r.text}):r.file&&o.push({type:"you",file:r.file,filename:r.filename}),Object(m.a)({},e,{messages:e.messages});default:return e}}var Q=p()(),H=Object(f.routerMiddleware)(Q);var G=n(6266),J=n(6265),q=n(7),Z=n(8),$=n(10),ee=n(9),te=n(11),ne=n(4),ae=n(37),re=function(e){function t(){return Object(q.a)(this,t),Object($.a)(this,Object(ee.a)(t).apply(this,arguments))}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){return r.a.createElement(Ue,null,function(e){return e=e||{func:{toAccount:function(){}}},r.a.createElement(ne.d,{onClick:e.func.toAccount,style:{marginLeft:"auto"}},r.a.createElement(ae.a,null))})}}]),t}(a.Component);function oe(e){return console.log("blob blob",e),new Promise(function(t,n){var a=[],r=new FileReader,o=File.prototype.slice,i=16384,c=Math.ceil(e.size/i),l=0;function s(){var t=l*i,n=t+i>=e.size?e.size:t+i;r.readAsArrayBuffer(o.call(e,t,n))}r.onerror=function(e){console.log("get slice blob error",e),n()},r.onload=function(e){a.push(e.target.result),++l<c?s():(console.log("getfileslice",{arr:a}),t(a))},s()})}var ie=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).label="",n.set=function(){},n.handleFile=function(){var e=Object(O.a)(w.a.mark(function e(t){var a,r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,oe(a).catch(console.log);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return");case 8:console.log("btn pic file",{result:r}),n.set(r,a.name);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.val,n=e.func;return t&&n&&(this.label=t.btnpicfile_label,this.set=n.btnpicfile_set),r.a.createElement("div",null,r.a.createElement("input",{type:"file",id:"raised-button-file",style:{display:"none"},onChange:this.handleFile}),r.a.createElement("label",{htmlFor:"raised-button-file"},r.a.createElement(ne.b,{raised:!0,component:"span"},this.label)))}}]),t}(a.Component);function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{btnpicfile_label:"picture"},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{btnpicfile_set:function(){}};return r.a.createElement(ie,{val:e,func:t})}var le=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).state={target:""},n.handlePicFile=function(e){n.file=e},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this,t=this.props.closeModal;return r.a.createElement(Ue,null,function(n){return n=n||{func:{excuteTweet:function(){}},val:{}},r.a.createElement("div",{style:{margin:10}},r.a.createElement(ne.o,{label:"tweet",multiline:!0,margin:"normal",variant:"outlined",rows:"6",style:{width:"100%"},value:e.state.target,onChange:function(t){e.setState({target:t.target.value})}}),r.a.createElement("br",null),r.a.createElement("div",{style:{bottom:0}},r.a.createElement("div",{style:{float:"left"}},ce({btnpicfile_label:"picture"},{btnpicfile_set:e.handlePicFile})),r.a.createElement(ne.b,{style:{float:"right"},onClick:function(){n.func.excuteTweet(e.state.target,e.file),e.setState({target:""}),t()}},"tweet")))})}}]),t}(a.Component);var se=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).state={open:!1},n.handleOpen=function(){n.setState({open:!0})},n.handleClose=function(){n.setState({open:!1})},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(ne.b,{onClick:this.handleOpen},"tweet"),r.a.createElement(ne.f,{"aria-labelledby":"simple-modal-title","aria-describedby":"simple-modal-description",open:this.state.open,onClose:this.handleClose,style:{display:"flex"}},r.a.createElement("div",{style:{width:"60%",height:280,flex:"0 1 auto",margin:"auto",background:"white"}},r.a.createElement("div",null,r.a.createElement(ne.d,{onClick:this.handleClose,style:{float:"right"}},r.a.createElement(ae.d,null)),r.a.createElement(ne.q,{variant:"h5",style:{textAlign:"center"}},"\u30c4\u30a4\u30fc\u30c8\u3059\u308b")),r.a.createElement("br",null),(e=this.handleClose,r.a.createElement(le,{closeModal:e})))));var e}}]),t}(a.Component);var ue=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).toAccount=function(){var e=n.props.history;console.log("this.props",n.props),e&&e.push("/account")},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){return r.a.createElement(Ue,null,function(e){return e=e||{func:{reload:function(){}},val:{}},r.a.createElement(ne.d,{onClick:function(){e.func.reload()},style:{marginLeft:"auto"}},r.a.createElement(ae.c,null))})}}]),t}(a.Component),de=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).state={target:""},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(Ue,null,function(t){return t=t||{func:{searchUser:function(e){console.log({id:e})}}},r.a.createElement("div",null,r.a.createElement(ne.e,{placeholder:"Search\u2026",value:e.state.target,onChange:function(t){e.setState({target:t.target.value})}}),r.a.createElement(ne.d,{onClick:function(){t.func.searchUser(e.state.target),e.setState({target:""})}},r.a.createElement(ae.e,null)))})}}]),t}(a.Component),pe=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).state={tab:0},n.handleChange=function(e,t){n.setState({tab:t})},n.titles=[],n.nodeId="",n.pages=[],n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.func;t&&n&&(this.titles=t.titles,this.pages=t.pages,this.nodeId=t.nodeId);var a=this.state.tab;return r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(ne.a,{position:"static",style:{backgroundColor:"white"}},r.a.createElement(ne.p,null,r.a.createElement(ne.n,{value:a,onChange:this.handleChange,style:{color:"black"}},this.titles?this.titles.map(function(e,t){return r.a.createElement(ne.h,{label:e,key:t})}):void 0),r.a.createElement(ue,null),r.a.createElement(de,null),r.a.createElement(re,null),r.a.createElement(se,null))),this.pages?this.pages.map(function(e,t){return a===t&&e}):void 0)}}]),t}(r.a.Component);var fe=function(e,t){if(t&&t.kad)return console.log("findpicture",{url:e}),new Promise(function(n,a){function r(){return(r=Object(O.a)(w.a.mark(function t(){var r,o,i=arguments;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>0&&void 0!==i[0]?i[0]:new C.a,!Object.keys(r.keyValueList).includes(e)){t.next=6;break}console.log("fownd picture",r.keyValueList[e]);try{n(window.URL.createObjectURL(new Blob(r.keyValueList[e].chunks)))}catch(c){a("findpicture blob error",{error:c})}t.next=12;break;case 6:return console.log("findpicture findvalue"),t.next=9,r.findValue(e).catch(console.log);case 9:(o=t.sent)||a("file not fownd");try{console.log("findpicture findvalue",{result:o}),n(window.URL.createObjectURL(new Blob(o.chunks)))}catch(c){a("findpicture blob error",{error:c},{result:o})}case 12:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}!function(){r.apply(this,arguments)}(t.kad)})},he=function(e){function t(e){var n;Object(q.a)(this,t),(n=Object($.a)(this,Object(ee.a)(t).call(this,e))).state={imgsrc:void 0};var a=n.props.imageUrl;return n.imageUrl=a,n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.imageUrl;console.log("picture didmount",{imageUrl:t}),Object(O.a)(w.a.mark(function n(){var a;return w.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=5;break}return n.next=3,fe(t,e.p2p).catch(console.log);case 3:(a=n.sent)&&e.setState({imgsrc:a});case 5:case"end":return n.stop()}},n,this)}))()}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props.imageUrl;console.log("picture didupdate",{imageUrl:t}),Object(O.a)(w.a.mark(function n(){var a;return w.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t===e.imageUrl){n.next=7;break}return e.imageUrl=t,console.log("componentDidUpdate find"),n.next=5,fe(t,e.p2p).catch(console.log);case 5:(a=n.sent)&&e.setState({imgsrc:a});case 7:case"end":return n.stop()}},n,this)}))()}},{key:"render",value:function(){var e=this,t=this.props.imageUrl;return r.a.createElement(ge,null,function(n){return n=n||{func:{},val:{p2p:{}}},e.p2p=n.val.p2p,r.a.createElement("div",null,t,r.a.createElement("img",{src:e.state.imgsrc,alt:t,width:"70%"}))})}}]),t}(a.Component);var me=function(e){function t(){return Object(q.a)(this,t),Object($.a)(this,Object(ee.a)(t).apply(this,arguments))}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.tweet,a=t.index;return r.a.createElement(ge,null,function(t){return t=t||{func:{onClickId:function(){}},val:{}},r.a.createElement("div",{style:{border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da",margin:3},key:a},r.a.createElement(ne.d,{onClick:e.toAccount},r.a.createElement(ae.a,null)),n.nickname,r.a.createElement(ne.b,{onClick:function(){t.func.onClickId(n.id)}},n.id),r.a.createElement("br",null),r.a.createElement("div",{style:{float:"right",marginRight:20,marginBottom:20}},new Date(n.time).toString()),r.a.createElement("br",null),r.a.createElement("div",{style:{marginLeft:50}},n.msg,r.a.createElement("br",null),n.pic?(o=n.pic,console.log("setpicture",{imageUrl:o}),r.a.createElement(he,{imageUrl:o,key:o})):void 0),r.a.createElement("br",null));var o})}}]),t}(a.Component);var ve=Object(a.createContext)(),be=ve.Provider,ge=ve.Consumer,ye=function(e){function t(){return Object(q.a)(this,t),Object($.a)(this,Object(ee.a)(t).apply(this,arguments))}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.timeline,n=e.func,a=e.p2p;return console.log("timeline render",{timeline:t}),r.a.createElement(be,{value:{func:n,val:{p2p:a}}},r.a.createElement("div",null,t.map(function(e,t){return n=e,a=t,r.a.createElement(me,{tweet:n,index:a});var n,a})))}}]),t}(a.Component);function Ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{onClickId:function(){}};return console.log("settimeline",{timeline:e}),r.a.createElement(ye,{timeline:e,p2p:t,func:n})}var ke=n(6264),we=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).onClickId=function(e){var t=n.props,a=t.dispatch,r=t.history;e!==t.p2p.kad.nodeId?(F(V.findUser,e,a),r.push("/user")):r.push("/account")},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.twitter,n=e.p2p,a=e.dispatch;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;e.followIds.forEach(function(){var e=Object(O.a)(w.a.mark(function e(n){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(n,t.kad,a);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}())}(t,n)}},{key:"render",value:function(){var e=this.props,t=e.twitter,n=e.p2p;return console.log("timeline container render",{twitter:t}),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},function(){console.log("timeline test",t.timeline)},r.a.createElement("div",{style:{width:"50%"}},Ee(t.timeline,n,{onClickId:this.onClickId})))}}]),t}(a.Component),Oe=Object(ke.a)(Object(i.b)(function(e){return{twitter:e.twitter,p2p:e.p2p}})(we)),je=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).kbuckets=[],n.toUser=function(e){},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.val,a=t.func;return n&&a&&(this.kbuckets=n.kbuckets,this.toUser=a.toUser),console.log("nodelist",this.kbuckets),r.a.createElement("div",{style:{margin:"20px"}},r.a.createElement(ne.i,null,r.a.createElement(ne.l,null,r.a.createElement(ne.m,null,r.a.createElement(ne.k,null,"index"),r.a.createElement(ne.k,null,"nodes"))),r.a.createElement(ne.j,null,this.kbuckets.map(function(t,n){return t.length>0?r.a.createElement(ne.m,{key:n},r.a.createElement(ne.k,null,n),r.a.createElement(ne.k,null,t.map(function(t,n){return r.a.createElement(ne.b,{key:n,onClick:function(){e.toUser(t.nodeId)}},t.nodeId)}))):void 0}))))}}]),t}(a.Component);var Ce=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).messages={},n.toDm=function(e){},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.val,a=t.func;return n&&a&&(this.messages=n.dmlist_messages,this.toDm=a.toDm),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},r.a.createElement("div",{style:{width:"50%",border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}},r.a.createElement("div",{style:{margin:"1.5%"}},r.a.createElement("div",null,"dm list"),Object.keys(this.messages).map(function(t,n){var a=e.messages[t];return console.log({message:a}),r.a.createElement("div",{key:n},r.a.createElement(ne.b,{onClick:function(){e.toDm(t)}},t),r.a.createElement("br",null),a[a.length-1].text)}))))}}]),t}(a.Component);var xe=Object(a.createContext)(),Ie=xe.Provider,Ue=xe.Consumer,Ae=function(e){function t(){return Object(q.a)(this,t),Object($.a)(this,Object(ee.a)(t).apply(this,arguments))}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.val,n=e.func;return console.log("main index",this.props),r.a.createElement(Ie,{value:{val:t,func:n}},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{titles:[],pages:[],nodeId:""},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.a.createElement(pe,{value:e,func:t})}({titles:["timeline","dm","kademlia"],pages:[r.a.createElement(Oe,null),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dmlist_messages:{key:[{text:"sample"}]}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{toDm:function(e){}};return console.log("setdmlist",{val:e},{func:t}),r.a.createElement(Ce,{val:e,func:t})}(t,n),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{kbuckets:[]},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{toUser:function(e){}};return r.a.createElement(je,{val:e,func:t})}({kbuckets:t.kbuckets},n)],nodeId:t.nodeId},{}))}}]),t}(a.Component);var Te=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).nofiticationOpen=!1,n.nofiticationMessage="",n.nofiticationClose=function(){},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.val,n=e.func;return t&&n&&(this.nofiticationOpen=t.nofiticationOpen,this.nofiticationMessage=t.nofiticationMessage,this.nofiticationClose=n.nofiticationClose),r.a.createElement("div",null,r.a.createElement(ne.g,{anchorOrigin:{vertical:"top",horizontal:"center"},open:this.nofiticationOpen,onClose:this.nofiticationClose,message:this.nofiticationMessage}))}}]),t}(a.Component);var De=function(e,t){var n=e.history,a=e.dispatch;F(V.dmUserId,t,a),n&&n.push("/dm")},Me=function(e,t){var n=e.history,a=e.dispatch;F(V.findUser,t,a),n&&n.push("/user")},Se=function(e){var t=e.history;t&&t.push("/main")},Re=function(e){function t(e){var n;Object(q.a)(this,t),(n=Object($.a)(this,Object(ee.a)(t).call(this,e))).nodeId="",n.excuteTweet=function(e,t){var a=n.props,r=a.dispatch,o=a.p2p,i=a.twitter;_(e,o.kad,r,i,{picture:t})},n.setFile=function(e){var t=n.props.dispatch;F(V.selectFile,e,t)},n.searchUser=function(e){var t=n.props,a=t.dispatch,r=t.p2p,o=t.history;function i(){return(i=Object(O.a)(w.a.mark(function t(){var n,r,i=arguments;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.length>0&&void 0!==i[0]?i[0]:new C.a,F(V.loading,!0,a),console.log("searchUser",{userId:e}),!n.f.getPeerFromnodeId(e)){t.next=10;break}F(V.loading,!1,a),F(V.findUser,e,a),o.push("/user"),t.next=15;break;case 10:return t.next=12,n.findNode(e,n.f.getCloseEstPeer(e)).catch(console.log);case 12:r=t.sent,F(V.loading,!1,a),r&&(F(V.findUser,e,a),o.push("/user"));case 15:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}!function(){i.apply(this,arguments)}(r.kad)},n.toAccount=function(){var e=n.props.history;console.log("this.props",n.props),e&&e.push("/account")},n.nofiticationClose=function(){var e=n.props.dispatch;F(V.nofiticationOpen,!1,e)},n.toDm=function(e){De(n.props,e)},n.toUser=function(e){Me(n.props,e)};var a=n.props,r=a.p2p,o=a.history;return n.state={value:0,kbuckets:r.kad?r.kad.kbuckets:[]},r.kad||o.push("/"),n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.p2p;e.kad&&(this.nodeId=e.kad.nodeId)}},{key:"componentDidMount",value:function(){var e=this.props.p2p;this.listenAddPeer(e.kad)}},{key:"listenAddPeer",value:function(e){var t=this;e&&(console.log("addlister"),e.callback.onAddPeer=function(n){console.log("onaddpeer",{data:n}),t.setState({kbuckets:e.kbuckets})})}},{key:"render",value:function(){var e=this.props,t=e.p2p,n=e.condition,a=e.dm;return console.log("main",{p2p:t}),r.a.createElement("div",null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{kbuckets:[],nodeId:"",dmlist_messages:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{excuteTweet:function(){},reload:function(){},setFile:function(){},searchUser:function(){},toAccount:function(){},toDm:function(e){},toUser:function(e){}};return r.a.createElement(Ae,{val:e,func:t})}({kbuckets:this.state.kbuckets,nodeId:this.nodeId,dmlist_messages:a.messages},{excuteTweet:this.excuteTweet,reload:{},setFile:this.setFile,searchUser:this.searchUser,toAccount:this.toAccount,toDm:this.toDm,toUser:this.toUser}),r.a.createElement(ne.f,{open:n.loading,style:{display:"flex",justifyContent:"center",alignItems:"center"}},r.a.createElement(ne.c,null)),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{nofiticationOpen:!1,nofiticationMessage:""},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{nofiticationClose:function(){}};return r.a.createElement(Te,{val:e,func:t})}({nofiticationOpen:n.nofiticationOpen,nofiticationMessage:n.nofiticationMessage},{nofiticationClose:this.nofiticationClose}))}}]),t}(r.a.Component),_e=Object(i.b)(function(e){return{p2p:e.p2p,twitter:e.twitter,condition:e.condition,dm:e.dm}})(Re),Le=n(413),Pe=n.n(Le),We=n(178),Ve=n.n(We),Be=n(94),Fe=n.n(Be),Ke=n(177),Ne=n.n(Ke),Ye=n(111),Xe=n.n(Ye),ze=n(179),Qe=n.n(ze),He=n(93),Ge=n.n(He),Je=n(131),qe=n.n(Je),Ze=n(12),$e=n.n(Ze),et=function(e){return{layout:Object(h.a)({width:"auto",display:"block",marginLeft:3*e.spacing.unit,marginRight:3*e.spacing.unit},e.breakpoints.up(400+3*e.spacing.unit*2),{width:400,marginLeft:"auto",marginRight:"auto"}),paper:{marginTop:8*e.spacing.unit,display:"flex",flexDirection:"column",alignItems:"center",padding:"".concat(2*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px")},avatar:{margin:e.spacing.unit,backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing.unit},submit:{marginTop:3*e.spacing.unit}}},tt=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).nickname="null",n.handlePubkey=function(){var e=Object(O.a)(w.a.mark(function e(t){var a,r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:(r=new FileReader).onload=function(){n.pubKey=r.result},r.readAsText(a);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.handleSeckey=function(){var e=Object(O.a)(w.a.mark(function e(t){var a,r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:(r=new FileReader).onload=function(){n.secKey=r.result},r.readAsText(a);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.classes,a=t.login,o=t.register;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ne.a,null),r.a.createElement("main",{className:n.layout},r.a.createElement(Ge.a,{className:n.paper},r.a.createElement(Ve.a,{className:n.avatar},r.a.createElement(Qe.a,null)),r.a.createElement(qe.a,{component:"h1",variant:"h5"},"Dtwi"),r.a.createElement("form",{className:n.form},r.a.createElement("div",{style:{border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}},r.a.createElement(Xe.a,{margin:"normal",required:!0,fullWidth:!0},r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("input",{type:"file",id:"pubkey",style:{display:"none"},onChange:this.handlePubkey}),r.a.createElement("label",{htmlFor:"pubkey"},r.a.createElement(Fe.a,{raised:!0,component:"span"},"pubKey")))),r.a.createElement(Xe.a,{margin:"normal",required:!0,fullWidth:!0},r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("input",{type:"file",id:"seckey",style:{display:"none"},onChange:this.handleSeckey}),r.a.createElement("label",{htmlFor:"seckey"},r.a.createElement(Fe.a,{raised:!0,component:"span"},"secKey")))),r.a.createElement(Fe.a,{fullWidth:!0,variant:"contained",color:"primary",className:n.submit,onClick:function(){console.log("login",e.pubKey,e.secKey),a(e.pubKey,e.secKey)}},"Sign in")),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",{style:{textAlign:"center",border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}},r.a.createElement(ne.o,{label:"nick name",onChange:function(t){e.nickname=t.target.value}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Fe.a,{fullWidth:!0,variant:"contained",onClick:function(){o(e.nickname)}},"register"))))))}}]),t}(a.Component);var nt=n(181),at=n.n(nt),rt=n(29).Buffer;var ot=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).targetAddress="35.196.94.146",n.targetPort=2e4,n.state={videoSrc:void 0,localSrc:void 0},n.connectNode=function(e,t){var a=n.props.dispatch,r="http://".concat(n.targetAddress,":").concat(n.targetPort);console.log(n.targetAddress,{targetUrl:r}),y(b.targetUrl,r,a);var o=new Pe.a(n.targetAddress,n.targetPort,{pubkey:e,seckey:t});y(b.node,o,a),y(b.kad,o.kad,a),console.log(o.kad.cypher.pubKey);var i=document.createElement("a");return i.href=window.URL.createObjectURL(new Blob([o.kad.cypher.pubKey],{type:"text/plain"})),i.download="pubkey.txt",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),(i=document.createElement("a")).href=window.URL.createObjectURL(new Blob([o.kad.cypher.secKey],{type:"text/plain"})),i.download="seckey.txt",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new C.a,t=arguments.length>1?arguments[1]:void 0;console.log({kad:e}),e.events.store["twitter.js"]=function(n){console.log("twitter event",{value:n}),"tweet"===n.type&&(console.log("on tweet"),R(e,t))}}(o.kad,a),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new C.a,t=arguments.length>1?arguments[1]:void 0;e.events.p2p["dm.js"]=function(e){var n;n=e.text?{nodeId:e.nodeId,text:e.text}:{nodeId:e.nodeId,file:e.file,filename:e.filename},t({type:Y.RECEIVE_DM,data:n}),F(V.nofiticationOpen,!0,t),F(V.nofiticationMessage,"dm comming \u300c".concat(e.text,"\u300d"),t)}}(o.kad,a),o},n.toMain=function(){n.props.history.push("/main")},n.register=function(e){var t=n.props.dispatch;L(T.nickname,e,t),n.connectNode(),n.toMain()},n.login=function(e,t){try{var a=(i="test",c=t,at.a.privateEncrypt(c,new rt.from(i)).toString("base64"));"test"===(r=a,o=e,at.a.publicDecrypt(o,new rt.from(r,"base64")).toString("utf8"))?n.connectNode(e,t):console.log("error"),n.toMain()}catch(l){console.log({error:l})}var r,o,i,c},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){},n=$e()(et)(tt);return r.a.createElement(n,{login:e,register:t})}(this.login,this.register))}}]),t}(r.a.Component),it=Object(i.b)(function(e){return{twitter:e.twitter}})(ot),ct=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).follows=[],n.onClickId=function(e){console.log({id:e})},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.value,a=t.func;return n&&a&&(this.follows=n.follows,this.onClickId=a.onClickId),r.a.createElement("div",{style:{textAlign:"center",border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}},r.a.createElement("div",null,"follow list"),this.follows.map(function(t,n){return r.a.createElement("div",null,r.a.createElement(ne.b,{onClick:function(){e.onClickId(t)},key:n,style:{width:"90%"}},t),r.a.createElement("br",null))}))}}]),t}(a.Component);var lt=Object(a.createContext)(),st=(lt.Provider,lt.Consumer,function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).twitter=[],n.toMain=function(){},n.p2p={kad:{nodeId:"null",cypher:{secKey:"null",pubKey:"null"}}},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.func;return t&&n&&(this.twitter=t.twitter,this.toMain=n.toMain,this.p2p=t.p2p),console.log("account context",this.p2p),r.a.createElement("div",null,r.a.createElement(ne.d,{onClick:this.toMain,style:{marginLeft:"auto"}},r.a.createElement(ae.b,null)),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{width:"50%"}},r.a.createElement("div",{style:{border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}},"nodeId",r.a.createElement("br",null),this.p2p.kad.nodeId,r.a.createElement("br",null)),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{follows:[]},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{onClickId:function(e){console.log({id:e})}};return r.a.createElement(ct,{value:e,func:t})}(t,n)),r.a.createElement("div",{style:{flex:1,border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}},r.a.createElement("div",null,"my post"),Ee(this.twitter[T.myTweets],t.p2p)))," ")}}]),t}(a.Component));var ut=function(e){function t(e){var n;Object(q.a)(this,t),(n=Object($.a)(this,Object(ee.a)(t).call(this,e))).toMain=function(){var e=n.props.history;e&&e.push("/main")},n.onClickId=function(e){var t=n.props,a=t.dispatch,r=t.history;e!==t.p2p.kad.nodeId&&(F(V.findUser,e,a),r.push("/user"))};var a=n.props,r=a.p2p,o=a.history;return r.kad||o.push("/"),n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.twitter,n=e.p2p;return r.a.createElement("div",null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{twitter:[],follows:[],p2p:{kad:{nodeId:"null",cypher:{secKey:"-----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAsS+dizngIjgt5wKPD4IAXKd/FgcCR1ygx15WcuYw1krRC/va1+exphbA WUUthHTraT1Qt1ptKEaEHGAzYQgmVvM2JmNTIF53ndAtIuDPHIRTD4bnPPi75ynxynqTEtw5 +42cgkVRuPZ28spqxDG6G8zjQwYyNS58ODmCKnXT3BMu7SDv4gJYsPPR0hXc6c2ABy+vVvYM DbIOJ06e2Z3+I1I6wDlOLjRW2DoaEQ4phwxYbWCaWjIajUhoE+nHCGeM8ybyWWNGqJ7sTai+ XRUcyWdRvHPSuIpXUlB/aWI6WYC1OczDT4L2NZS1NmuuxBOcZn9JbGnZQXdom8bjaNz1wQID AQABAoIBAEgINoEKV08yDZ8zkBta23DPez/mO4vtYUOL25M8d7A2nEPF8NMDU1pVN39TO0z1 B1syXSUdMvFDsaOjjF+vI38HwwTaLkojfXd/0UmzoR9TwDy4uDs2V5WDnNOW/0GUnFHi4TSo n6+VKwhLOBpoqONyaRWvaCvsqP1mi79dRXLbACwiwwAGP5DuhQIMZOtuQDfa3d/shdhvbGhe zn5bo5rjPeijtc+OZfxt1BHCuSL6fIc2NYU61tv77uK9IpPcpfQHWkArncRxPVlsn8jRgg7E tJtbw8FETxchdIbeduuVehAb2wVd2DMa40TQbXsfyVaAqBfc4J6mrX9v1/89es0CgYEA4bOR rwNBC4gU9TnX84AqoFmBAut/97MEWAcvuwV3U23mCAZlbpHq12vBusfGLgcBhKbx1tpq+DKf 7ZU5n+bmWicY2gde2RdjLKJjVxKDupj09rEXXTYEPY5pu0aCqp779QulMGL15LrJSYw7aAWg Ms6GxnFmR7MXrL0w3Q6zNH8CgYEAyPjFGSj/bx/CxswOiE0KI9SpzfmJ6enrfuq243i79uiq mQ7PIdR04AKiUXkfwKQlKMtV5j1GFz+VUgH4HiCyBWjVn3z1hpjS9cmYi0fToD0Ltrf+d6IO 85OkZMwbvd5HFilQCzYHXDSmyg1e51heBPrfEngi74+XZQbI6sF1tb8CgYBeo0T69YpYo37m NJLwb1VwVxdZehX2bwHrR1gkO26FdRd3VfdCHb0zBuP8xbe7pQRl8vqE9KDV4aRdoqy+97qv IqWxBlYnAT98f7rXz9OccnaE2kzJsNSmWwjKlg5ELNXJMlDZsSUZ+5hbVomyXGmH5EFvBC22 8smCjPHoPzm1UQKBgQCoWAI6BiaZfgBZJ/sQX4Ab7Xrjp6DHyQNUB+Z0+uBwfgrRNR96lg3k yzAOkShw5M6fslvdBfydYsyAqledXQPiFiPDehfszD0CWAEowlzZ/+i9ALjum1hs3oK5UGP4 kqX3QVnkWjimGxCPdc3GejYfc8nCHdId26kUni9UvgMM3wKBgEmCvlBXcYycUmyt9OQSYaJh LNS65YrHnG5JXqO0tdJcnBJFiqAzOH/VYiKep6vmbP2RpBbMYA0vb/+3Y17QajfGAD7IlzZr zRUsJ8CjaX/5/VeCtjKC5igQdMOkkxJnwOZvKma32EIoA3VPo8p4XqLZsQTtxT+XWeAXElzW nrUc -----END RSA PRIVATE KEY----- ",pubKey:"-----BEGIN RSA PUBLIC KEY----- MIIBCgKCAQEAsS+dizngIjgt5wKPD4IAXKd/FgcCR1ygx15WcuYw1krRC/va1+exphbAWUUt hHTraT1Qt1ptKEaEHGAzYQgmVvM2JmNTIF53ndAtIuDPHIRTD4bnPPi75ynxynqTEtw5+42c gkVRuPZ28spqxDG6G8zjQwYyNS58ODmCKnXT3BMu7SDv4gJYsPPR0hXc6c2ABy+vVvYMDbIO J06e2Z3+I1I6wDlOLjRW2DoaEQ4phwxYbWCaWjIajUhoE+nHCGeM8ybyWWNGqJ7sTai+XRUc yWdRvHPSuIpXUlB/aWI6WYC1OczDT4L2NZS1NmuuxBOcZn9JbGnZQXdom8bjaNz1wQIDAQAB -----END RSA PUBLIC KEY-----"}}}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{toMain:function(){},onClickId:function(){}};return r.a.createElement(st,{value:e,func:t})}({twitter:t,follows:t[T.followIds],p2p:n},{toMain:this.toMain,onClickId:this.onClickId}))}}]),t}(a.Component),dt=Object(i.b)(function(e){return{p2p:e.p2p,twitter:e.twitter}})(ut),pt=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).toAccount=function(){var e=n.props.history;console.log("this.props",n.props),e&&e.push("/account")},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){return r.a.createElement(mt,null,function(e){return e=e||{func:{toDm:function(){},follow:function(){}},val:{id:""}},r.a.createElement("div",{style:{border:"1px solid",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}},r.a.createElement(ne.d,null,r.a.createElement(ae.a,null)),r.a.createElement(ne.b,null,e.val.id),r.a.createElement("br",null),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(ne.b,{onClick:function(){e.func.follow(e.val.id)}},"follow"),r.a.createElement(ne.b,{onClick:function(){e.func.toDm(e.val.id)}},"dm")))})}}]),t}(a.Component),ft=Object(a.createContext)(),ht=ft.Provider,mt=ft.Consumer,vt=function(e){function t(){return Object(q.a)(this,t),Object($.a)(this,Object(ee.a)(t).apply(this,arguments))}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.func;return r.a.createElement(ht,{value:{func:n,val:t}},r.a.createElement(ne.d,{onClick:n.toMain,style:{marginLeft:"auto"}},r.a.createElement(ae.b,null)),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{width:500}},r.a.createElement(pt,null)),r.a.createElement("div",{style:{flex:1}},r.a.createElement("div",null,"user post"),Ee(t.timeline,t.p2p))))}}]),t}(a.Component);var bt=function(e){function t(e){var n;Object(q.a)(this,t),(n=Object($.a)(this,Object(ee.a)(t).call(this,e))).toMain=function(){var e=n.props.history;e&&e.push("/main")},n.toDm=function(e){var t=n.props,a=t.history,r=t.dispatch;F(V.dmUserId,e,r),a&&a.push("/dm")},n.follow=function(e){!function(e,t){t({type:D.FOLLOW,data:e})}(e,n.props.dispatch)};var a=n.props,r=a.p2p,o=a.history;return r.kad||o.push("/"),n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"componentDidMount",value:function(){var e=Object(O.a)(w.a.mark(function e(){var t,n,a,r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,n=t.condition,a=t.p2p,r=t.dispatch,M(n.findUser,a.kad,r);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTargetTweets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,n=[];return t.timeline.forEach(function(t){t.id===e&&n.push(t)}),n}},{key:"render",value:function(){var e=this.props,t=e.twitter,n=e.condition,a=e.p2p,o=this.getTargetTweets(n.findUser,t);return r.a.createElement("div",null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{timeline:[],id:"",p2p:void 0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{toMain:function(){},follow:function(){},toDm:function(){}};return r.a.createElement(vt,{value:e,func:t})}({timeline:o,id:n.findUser,p2p:a},{toMain:this.toMain,follow:this.follow,toDm:this.toDm}))}}]),t}(a.Component),gt=Object(i.b)(function(e){return{p2p:e.p2p,twitter:e.twitter,condition:e.condition}})(bt),yt=(n(6171),n(414)),Et=n(77),kt=n.n(Et),wt=n(261),Ot=n.n(wt),jt=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).state={videoSrc:void 0,localSrc:void 0},n.peer={},n.closeModal=function(){},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"setProps",value:function(e){var t=e.val,n=e.func;t&&n&&(this.peer=t.videochat_peer,this.closeModal=t.videochat_closeModal)}},{key:"componentDidMount",value:function(){var e=this;this.setProps(this.props),console.log("videochat didmount",this.peer),function(){var t=Object(O.a)(w.a.mark(function t(){var n,a,r=arguments;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>0&&void 0!==r[0]?r[0]:new kt.a,t.next=3,Object(wt.getLocalStream)();case 3:a=t.sent,console.log("videochat didmout",{peer:n}),new Ot.a(n,a).stream=function(t){console.log("videochat",{media:t}),e.video.srcObject=t};case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()(this.peer)}},{key:"render",value:function(){var e=this;return console.log("media",this.state.videoSrc,this.state.localSrc),r.a.createElement("div",{style:{flex:"0 1 auto",margin:"auto"}},r.a.createElement("video",{ref:function(t){e.video=t},autoPlay:!0,style:{width:"100%",height:"100%"}}))}}]),t}(a.Component);var Ct=function(e){function t(){var e,n;Object(q.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object($.a)(this,(e=Object(ee.a)(t)).call.apply(e,[this].concat(r)))).state={text:"",videoModal:!1},n.toAccount=function(){var e=n.props.history;console.log("this.props",n.props),e&&e.push("/account")},n.state={messageList:[]},n.sendComment=function(){},n.toMain=function(){},n.peer={},n.openVideoModal=function(){n.setState({videoModal:!0});!function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt.a).send("openVideo","chat_video")}(n.peer)},n.closeVideoModal=function(){n.setState({videoModal:!1});!function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt.a).send("closeVideo","chat_video")}(n.peer)},n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.value,a=t.func;if(n&&a){this.sendComment=a.sendComment,this.toMain=a.toMain,this.peer=n.chat_peer;!function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt.a).events.data["chat.js"]=function(t){"chat_video"===t.label&&("openVideo"===t.data?e.setState({videoModal:!0}):"closeVideo"===t.data&&e.setState({videoModal:!1}))}}(this.peer);var o=n.messages[n.nodeId];o&&(this.dataSource=o.map(function(e){console.log({messagefile:new Blob(e.file)});var t="me"===e.type?"right":"left";if(e.text)return{position:t,type:"text",text:e.text,date:new Date};var n={uri:window.URL.createObjectURL(new Blob(e.file)),blob:new Blob(e.file),status:{click:!0,loading:1},size:"".concat(new Blob(e.file).size/1e3,"kb"),width:300,height:300};return{position:t,type:"file",filename:e.filename,status:"send",text:"file",data:n,onDownload:function(){console.log("ondownload")},date:new Date}}))}return r.a.createElement("div",null,r.a.createElement(ne.d,{onClick:this.toMain},r.a.createElement(ae.b,null)),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",minHeight:"90vh"}},r.a.createElement(yt.MessageList,{className:"message-list",lockable:!0,toBottomHeight:"100%",dataSource:this.dataSource,onClick:function(e){if(console.log({object:e}),"file"===e.type){var t=document.createElement("a");t.href=e.data.uri,t.download=e.filename,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}),r.a.createElement("div",{style:{width:"100%",marginTop:"auto"}},r.a.createElement(ne.o,{label:"comment",multiline:!0,margin:"normal",variant:"outlined",rows:"3",value:this.state.text,onChange:function(t){return e.setState({text:t.target.value})},style:{width:"100%"}}),r.a.createElement("br",null),r.a.createElement(ne.b,{onClick:this.openVideoModal},"video "),r.a.createElement("div",{style:{float:"right",display:"flex"}},ce({btnpicfile_label:"file"},{btnpicfile_set:function(t,n){console.log("chat pic",n),e.selectFile=t,e.selectFilename=n}}),r.a.createElement(ne.b,{onClick:function(){e.sendComment({text:e.state.text,file:e.selectFile,filename:e.selectFilename}),e.setState({text:""})}},"comment")),r.a.createElement(ne.f,{"aria-labelledby":"simple-modal-title","aria-describedby":"simple-modal-description",open:this.state.videoModal,onClose:function(){e.closeVideoModal()},style:{display:"flex"}},r.a.createElement("div",{style:{width:"70%",height:"70%",flex:"0 1 auto",margin:"auto",background:"white"}},r.a.createElement(ne.d,{onClick:function(){e.closeVideoModal()},style:{float:"right"}},r.a.createElement(ae.d,null)),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{videochat_peer:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{videochat_closeModal:function(){}};return console.log("setvideochat",{val:e},{func:t}),r.a.createElement(jt,{val:e,func:t})}({videochat_peer:this.peer},{}))))))}}]),t}(a.Component);var xt=function(e){function t(e){var n;Object(q.a)(this,t),(n=Object($.a)(this,Object(ee.a)(t).call(this,e))).sendComment=function(e){var t=n.props,a=t.condition,r=t.p2p,o=t.dispatch;console.log("sendcomment",{payload:e}),function(e,t){X.apply(this,arguments)}(a.dmUserId,e.text,r.kad,o,{file:e.file,filename:e.filename})},n.toMain=function(){Se(n.props)};var a=n.props,r=a.p2p,o=a.history;return r.kad||o.push("/"),n}return Object(te.a)(t,e),Object(Z.a)(t,[{key:"renderId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W;return r.a.createElement("div",null,e.dmUserId)}},{key:"render",value:function(){var e=this.props,t=e.condition,n=e.dm,a=e.p2p;return r.a.createElement("div",null,this.renderId(t),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{messages:{},nodeId:"",chat_peer:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{sendComment:function(){},toMain:function(){}};return r.a.createElement(Ct,{value:e,func:t})}({messages:n.messages,nodeId:t.dmUserId,chat_peer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new C.a,t=arguments.length>1?arguments[1]:void 0;return e.f.getPeerFromnodeId(t)}(a.kad,t.dmUserId)},{sendComment:this.sendComment,toMain:this.toMain}))}}]),t}(a.Component),It=Object(i.b)(function(e){return{p2p:e.p2p,twitter:e.twitter,condition:e.condition,dm:e.dm}})(xt),Ut={store:Object(c.d)(Object(c.c)({p2p:E,router:f.routerReducer,twitter:P,condition:K,dm:z}),Object(c.a)(u.a,s.a,H)),history:Q};Object(o.render)(r.a.createElement(i.a,{store:Ut.store},r.a.createElement(G.a,null,r.a.createElement("div",null,r.a.createElement(J.a,{exact:!0,path:"/",component:it}),r.a.createElement(J.a,{path:"/main",component:_e}),r.a.createElement(J.a,{path:"/account",component:dt}),r.a.createElement(J.a,{path:"/user",component:gt}),r.a.createElement(J.a,{path:"/dm",component:It})))),document.getElementById("root"))}},[[5690,2,1]]]);
//# sourceMappingURL=main.923b6b45.chunk.js.map